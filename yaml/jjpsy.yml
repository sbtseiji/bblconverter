constants:
  maxnames: 20


parenyear: &parenyeardot
  - text::"("
  - 
    - cond::ifdef[year,true]
    -
      - value::year
    -
      - value::pubstate
  - text::"). "

family-giveni: &family-giveni 
  - 
    - cond::ifequal[listcount,maxnames]&&ifless[listcount,listtotal]
    -
      - text::"... "
    -
      - cond::ifgreater[listcount,maxnames]&&ifless[listcount,listtotal]
      -
        - text::""
      -
        - cond::ifequal[listcount,1]
        - 
          - value::family
          - text::", "
          - value::giveni
        -
          - cond::ifless[listcount,maxnames]
          -
            - cond::ifequal[listcount,listtotal]
            -
              - text::", & "
              - value::family
              - text::", "
              - value::giveni
            -
              - text::", "
              - value::family
              - text::", "
              - value::giveni                
          -
            - value::family
            - text::", "
            - value::giveni
  - count::1

jname: &jname 
  - 
    - cond::ifequal[listcount,maxnames]&&ifless[listcount,listtotal]
    -
      - text::"..."
    -
      - cond::ifgreater[listcount,maxnames]&&ifless[listcount,listtotal]
      -
        - text::""
      -
        - cond::ifequal[listcount,1]
        - 
          - value::family
          - text::" "
          - value::given
        -
          - cond::ifless[listcount,maxnames]
          -
            - text::"・"
            - value::family
            - text::" "
            - value::given
          -
            - value::family
            - text::" "
            - value::given

  - count::1

bookpart: &book
  - author: 
    -
      - cond::ifdef[field::author,true]
      -
        *jname
  - authortype:
    - 
      - cond::ifdef[field::author,true]
      -
        - cond::ifdef[field::authortype,true]
        -
          - text::"("
          - value::authortype
          - text::") "
  - editor: 
    -
      - cond::ifdef[field::editor,true]
      -
        *jname

  - editortype:
    - 
      - cond::ifdef[field::editor,true]
      -
        - cond::ifdef[field::editortype,true]
        -
          - text::"("
          - value::editortype
          - text::")"
        -
          - text::"(編)"
  - year: *parenyeardot
  - title: 
    - value::title
    -
      - cond::ifdef[field::subtitle,true]
      - 
        - delim::EMDASH
        - delim::EMDASH
        - value::subtitle
        - delim::EMDASH
        - delim::EMDASH
    - punct::" "
    -
      - cond::ifdef[field::edition,true]
      -
        - value::edition
    - value::publisher


driver:
  japanese:
    article:
      - author: *jname
      - year: *parenyeardot
      - title: 
        - value::title
        -
          - cond::ifdef[field::subtitle,true]
          - 
            - delim::EMDASH
            - delim::EMDASH
            - value::subtitle
            - delim::EMDASH
            - delim::EMDASH
        - punct::" "
      - journaltitle:
        - value::journaltitle
      - volume:
        - 
          - cond::ifdef[field::volume,true]
          -
            - text::", "
            - value::volume::italic
        -
          - cond::ifdef[field::number,true]
          -
            - cond::ifdef[field::volume,true]
            -
              - text::"("
              - value::number
              - text::")"
            -
              - text::", No."
              - value::number
      - pages:
        -
          - cond::ifdef[field::pages,true]
          -
            - text::", "
            - value::pages
            - text::"."
        - punct::""
      - doi:
        - 
          - cond::ifdef[field::doi,true]
          - 
            - delim::LINEBREAK
            - url::["https://doi.org/",value::doi]
    book: 
      # - text::"hoge"
        - cond::ifdef[field::related,false]
        -
          - cond::ifdef[field::translator,false]
          -
            - editor: 
              - value::family
      # - text::"gge"
      # - text::"hoge"

  other:
    article:
      - author: *family-giveni
      - year: *parenyeardot
      - title: 
        - value::title
        -
          - cond::ifdef[field::subtitle,true]
          - 
            - delim::COLON
            - delim::SPACE
            - value::subtitle
        - punct::". "
      - journaltitle:
        - value::journaltitle::italic
      - volume:
        - 
          - cond::ifdef[field::volume,true]
          -
            - text::", "
            - value::volume::italic
        -
          - cond::ifdef[field::number,true]
          -
            - cond::ifdef[field::volume,true]
            -
              - text::"("
              - value::number
              - text::")"
            -
              - text::"No."
              - value::number
      - pages:
        -
          - cond::ifdef[field::pages,true]
          -
            - text::", "
            - value::pages
        - punct::"."